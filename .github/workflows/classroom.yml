name: Autograding Tests
'on':
  - push
  - repository_dispatch
permissions:
  checks: write
  actions: read
  contents: read

jobs:
  # JOB: ÐžÐ¦Ð•ÐÐšÐ Ð—ÐÐ”ÐÐÐ˜Ð™ (3 Ð¿Ð°Ñ€Ð°Ð»Ð»ÐµÐ»ÑŒÐ½Ñ‹Ñ… Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸)
  run-autograding-tests:
    name: ÐžÑ†ÐµÐ½Ð¸Ð²Ð°Ð½Ð¸Ðµ Ð²ÑÐµÑ… Ð·Ð°Ð´Ð°Ñ‡
    runs-on: ubuntu-latest
    if: github.actor != 'github-classroom[bot]'
    
    strategy:
      matrix:
        task: [1, 2, 3]
      max-parallel: 3
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.x'
    
    # ============ Ð—ÐÐ”ÐÐ§Ð 1: ÐšÐÐ›Ð¬ÐšÐ£Ð›Ð¯Ð¢ÐžÐ  ============
    - name: "[TASK 1] Ð¡Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ"
      if: matrix.task == 1
      id: task1_add
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: "Ð—Ð°Ð´Ð°Ñ‡Ð° 1: Ð¡Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ"
        command: python task_01.py
        input: |
          5
          +
          3
        expected-output: '8'
        comparison-method: exact
        timeout: 5
        max-score: 10
    
    - name: "[TASK 1] Ð’Ñ‹Ñ‡Ð¸Ñ‚Ð°Ð½Ð¸Ðµ"
      if: matrix.task == 1
      id: task1_sub
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: "Ð—Ð°Ð´Ð°Ñ‡Ð° 1: Ð’Ñ‹Ñ‡Ð¸Ñ‚Ð°Ð½Ð¸Ðµ"
        command: python task_01.py
        input: |
          10
          -
          4
        expected-output: '6'
        comparison-method: exact
        timeout: 5
        max-score: 10
    
    - name: "[TASK 1] Ð”ÐµÐ»ÐµÐ½Ð¸Ðµ Ð½Ð° Ð½Ð¾Ð»ÑŒ"
      if: matrix.task == 1
      id: task1_div_zero
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: "Ð—Ð°Ð´Ð°Ñ‡Ð° 1: Ð”ÐµÐ»ÐµÐ½Ð¸Ðµ Ð½Ð° Ð½Ð¾Ð»ÑŒ"
        command: python task_01.py
        input: |
          10
          /
          0
        expected-output: 'error'
        comparison-method: contains
        timeout: 5
        max-score: 10
    
    # ============ Ð—ÐÐ”ÐÐ§Ð 2: ÐŸÐÐ›Ð˜ÐÐ”Ð ÐžÐœ ============
    - name: "[TASK 2] ÐŸÑ€Ð¾ÑÑ‚Ð¾Ð¹ Ð¿Ð°Ð»Ð¸Ð½Ð´Ñ€Ð¾Ð¼"
      if: matrix.task == 2
      id: task2_simple
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: "Ð—Ð°Ð´Ð°Ñ‡Ð° 2: ÐŸÑ€Ð¾ÑÑ‚Ð¾Ð¹ Ð¿Ð°Ð»Ð¸Ð½Ð´Ñ€Ð¾Ð¼"
        command: python task_02.py
        input: "racecar"
        expected-output: 'True'
        comparison-method: exact
        timeout: 5
        max-score: 15
    
    - name: "[TASK 2] ÐÐµ Ð¿Ð°Ð»Ð¸Ð½Ð´Ñ€Ð¾Ð¼"
      if: matrix.task == 2
      id: task2_not_palindrome
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: "Ð—Ð°Ð´Ð°Ñ‡Ð° 2: ÐÐµ Ð¿Ð°Ð»Ð¸Ð½Ð´Ñ€Ð¾Ð¼"
        command: python task_02.py
        input: "hello"
        expected-output: 'False'
        comparison-method: exact
        timeout: 5
        max-score: 15
    
    - name: "[TASK 2] ÐŸÑƒÑÑ‚Ð°Ñ ÑÑ‚Ñ€Ð¾ÐºÐ°"
      if: matrix.task == 2
      id: task2_empty
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: "Ð—Ð°Ð´Ð°Ñ‡Ð° 2: ÐŸÑƒÑÑ‚Ð°Ñ ÑÑ‚Ñ€Ð¾ÐºÐ°"
        command: python task_02.py
        input: ""
        expected-output: 'True'
        comparison-method: exact
        timeout: 5
        max-score: 10
    
    # ============ Ð—ÐÐ”ÐÐ§Ð 3: Ð¤Ð˜Ð‘ÐžÐÐÐ§Ð§Ð˜ ============
    - name: "[TASK 3] Fibonacci(0)"
      if: matrix.task == 3
      id: task3_fib0
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: "Ð—Ð°Ð´Ð°Ñ‡Ð° 3: Fibonacci(0)"
        command: python task_03.py
        input: "0"
        expected-output: '0'
        comparison-method: exact
        timeout: 5
        max-score: 10
    
    - name: "[TASK 3] Fibonacci(1)"
      if: matrix.task == 3
      id: task3_fib1
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: "Ð—Ð°Ð´Ð°Ñ‡Ð° 3: Fibonacci(1)"
        command: python task_03.py
        input: "1"
        expected-output: '1'
        comparison-method: exact
        timeout: 5
        max-score: 10
    
    - name: "[TASK 3] Fibonacci(10)"
      if: matrix.task == 3
      id: task3_fib10
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: "Ð—Ð°Ð´Ð°Ñ‡Ð° 3: Fibonacci(10)"
        command: python task_03.py
        input: "10"
        expected-output: '55'
        comparison-method: exact
        timeout: 5
        max-score: 20
    
    # - name: DEBUG - Ð§Ñ‚Ð¾ Ð² outputs?
    #   run: |
    #     echo "=== RAW OUTPUTS ==="
    #     echo "task1_add outputs:"
    #     echo "${{ toJson(steps.task1_add.outputs) }}"
        
    #     echo "task1_add.result:"
    #     echo "${{ steps.task1_add.outputs.result }}"
        
    #     # Ð”ÐµÐºÐ¾Ð´Ð¸Ñ€ÑƒÐµÐ¼ base64 Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ
    #     echo "${{ steps.task1_add.outputs.result }}" | base64 -d
    #     echo ""

    - name: Check if parser exists
      run: |
        echo "=== ÐŸÐ ÐžÐ’Ð•Ð ÐšÐ Ð¡ÐšÐ Ð˜ÐŸÐ¢ÐžÐ’ ==="
        if [ -f "tools/parse_scores.py" ]; then
          echo "âœ… parse_scores.py Ð½Ð°Ð¹Ð´ÐµÐ½"
          ls -la tools/
        else
          echo "âŒ parse_scores.py ÐÐ• Ð½Ð°Ð¹Ð´ÐµÐ½!"
          echo "Ð¡Ð¾Ð´ÐµÑ€Ð¶Ð¸Ð¼Ð¾Ðµ ÐºÐ°Ñ‚Ð°Ð»Ð¾Ð³Ð° tools:"
          ls -la tools/ || echo "ÐšÐ°Ñ‚Ð°Ð»Ð¾Ð³ tools Ð½Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚"
        fi

    # ============ ÐŸÐÐ Ð¡Ð˜Ðœ Ð Ð•ÐÐ›Ð¬ÐÐ«Ð• Ð‘ÐÐ›Ð›Ð« ============
    - name: Parse and Save Scores
      if: always()
      run: |
        # ÐŸÐ°Ñ€ÑÐ¸Ð¼ Ð¢ÐžÐ›Ð¬ÐšÐž Ñ€ÐµÐ°Ð»ÑŒÐ½Ñ‹Ðµ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹
        echo "=== ÐŸÐ°Ñ€ÑÐ¸Ð½Ð³ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð¾Ð² ==="
        
        if [ "${{ matrix.task }}" = "1" ]; then
          python3 tools/parse_scores.py 1 \
            "${{ steps.task1_add.outputs.result }}" \
            "${{ steps.task1_sub.outputs.result }}" \
            "${{ steps.task1_div_zero.outputs.result }}" > task1_score.txt
          
          echo "Ð—Ð°Ð´Ð°Ñ‡Ð° 1 Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:"
          cat task1_score.txt
          
        elif [ "${{ matrix.task }}" = "2" ]; then
          python3 tools/parse_scores.py 2 \
            "${{ steps.task2_simple.outputs.result }}" \
            "${{ steps.task2_not_palindrome.outputs.result }}" \
            "${{ steps.task2_empty.outputs.result }}" > task2_score.txt
          
          echo "Ð—Ð°Ð´Ð°Ñ‡Ð° 2 Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:"
          cat task2_score.txt
          
        elif [ "${{ matrix.task }}" = "3" ]; then
          python3 tools/parse_scores.py 3 \
            "${{ steps.task3_fib0.outputs.result }}" \
            "${{ steps.task3_fib1.outputs.result }}" \
            "${{ steps.task3_fib10.outputs.result }}" > task3_score.txt
          
          echo "Ð—Ð°Ð´Ð°Ñ‡Ð° 3 Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:"
          cat task3_score.txt
        fi

    - name: Upload Parsed Scores
      uses: actions/upload-artifact@v4
      with:
        name: parsed-scores-task-${{ matrix.task }}
        path: task*_score.txt  # Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ Ð²ÑÐµ Ñ„Ð°Ð¹Ð»Ñ‹ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð¾Ð²
        retention-days: 1

  # JOB: Ð¡Ð‘ÐžÐ ÐšÐ Ð˜Ð¢ÐžÐ“ÐžÐ’ÐžÐ™ Ð¡Ð’ÐžÐ”ÐšÐ˜
  generate-final-report:
    name: Ð˜Ñ‚Ð¾Ð³Ð¾Ð²Ð°Ñ ÑÐ²Ð¾Ð´ÐºÐ°
    runs-on: ubuntu-latest
    needs: run-autograding-tests
    if: always()

    steps:
    - name: Checkout code again
      uses: actions/checkout@v4

    - name: Download Parsed Scores
      uses: actions/download-artifact@v4
      with:
        path: ./parsed_scores
        pattern: parsed-scores-*
        merge-multiple: true
    
    - name: Debug Downloaded Files
      run: |
        echo "=== ÐŸÐ ÐžÐ’Ð•Ð ÐšÐ Ð¡ÐšÐÐ§ÐÐÐÐ«Ð¥ Ð¤ÐÐ™Ð›ÐžÐ’ ==="
        echo "Ð¡Ð¾Ð´ÐµÑ€Ð¶Ð¸Ð¼Ð¾Ðµ ÐºÐ°Ñ‚Ð°Ð»Ð¾Ð³Ð° ./parsed_scores:"
        ls -la ./parsed_scores/ || echo "ÐšÐ°Ñ‚Ð°Ð»Ð¾Ð³ Ð½Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚"
        
        echo ""
        echo "ÐŸÐ¾Ð¸ÑÐº Ñ„Ð°Ð¹Ð»Ð¾Ð² Ñ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð°Ð¼Ð¸:"
        find . -name "*score*.txt" -type f 2>/dev/null | while read file; do
          echo "Ð¤Ð°Ð¹Ð»: $file"
          cat "$file" || echo "ÐÐµ Ð¼Ð¾Ð³Ñƒ Ð¿Ñ€Ð¾Ñ‡Ð¸Ñ‚Ð°Ñ‚ÑŒ"
          echo "---"
        done
    
    - name: Calculate Total Scores
      id: calculate
      run: |
        echo "=== Ð ÐÐ¡Ð§Ð•Ð¢ Ð‘ÐÐ›Ð›ÐžÐ’ ==="
        
        # Ð˜Ñ‰ÐµÐ¼ Ñ„Ð°Ð¹Ð»Ñ‹ Ð²Ð¾ Ð²ÑÐµÑ… Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ñ‹Ñ… Ð¼ÐµÑÑ‚Ð°Ñ…
        TASK1=0
        TASK2=0
        TASK3=0
        
        # Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 1: Ð² downloaded artifacts
        if [ -f "./parsed_scores/task1_score.txt" ]; then
          TASK1=$(grep -oP 'TASK_SCORE=\K\d+' ./parsed_scores/task1_score.txt 2>/dev/null || echo "0")
          echo "ÐÐ°ÑˆÐ»Ð¸ task1_score.txt Ð² artifacts: $TASK1"
        fi
        
        if [ -f "./parsed_scores/task2_score.txt" ]; then
          TASK2=$(grep -oP 'TASK_SCORE=\K\d+' ./parsed_scores/task2_score.txt 2>/dev/null || echo "0")
          echo "ÐÐ°ÑˆÐ»Ð¸ task2_score.txt Ð² artifacts: $TASK2"
        fi
        
        if [ -f "./parsed_scores/task3_score.txt" ]; then
          TASK3=$(grep -oP 'TASK_SCORE=\K\d+' ./parsed_scores/task3_score.txt 2>/dev/null || echo "0")
          echo "ÐÐ°ÑˆÐ»Ð¸ task3_score.txt Ð² artifacts: $TASK3"
        fi
        
        # Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 2: Ð¿Ñ€ÑÐ¼Ð¾ Ð² ÐºÐ¾Ñ€Ð½Ðµ (Ð½Ð° Ð²ÑÑÐºÐ¸Ð¹ ÑÐ»ÑƒÑ‡Ð°Ð¹)
        if [ -f "task1_score.txt" ]; then
          SCORE=$(grep -oP 'TASK_SCORE=\K\d+' task1_score.txt 2>/dev/null || echo "0")
          echo "ÐÐ°ÑˆÐ»Ð¸ task1_score.txt Ð² ÐºÐ¾Ñ€Ð½Ðµ: $SCORE"
          TASK1=$SCORE
        fi
        
        # Ð’Ñ‹Ð²Ð¾Ð´Ð¸Ð¼ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹
        echo ""
        echo "Ð˜Ð¢ÐžÐ“ÐžÐ’Ð«Ð• Ð‘ÐÐ›Ð›Ð«:"
        echo "Ð—Ð°Ð´Ð°Ñ‡Ð° 1: $TASK1 (Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ 30 Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð¹Ð´ÐµÐ½Ð½Ñ‹Ñ… Ñ‚ÐµÑÑ‚Ð¾Ð²)"
        echo "Ð—Ð°Ð´Ð°Ñ‡Ð° 2: $TASK2"
        echo "Ð—Ð°Ð´Ð°Ñ‡Ð° 3: $TASK3"
        
        echo "task1_score=$TASK1" >> $GITHUB_OUTPUT
        echo "task2_score=$TASK2" >> $GITHUB_OUTPUT
        echo "task3_score=$TASK3" >> $GITHUB_OUTPUT
        echo "total_score=$(($TASK1 + $TASK2 + $TASK3))" >> $GITHUB_OUTPUT
    
    - name: Generate Final Summary
      run: |
        TASK1_SCORE=${{ steps.calculate.outputs.task1_score || 0 }}
        TASK2_SCORE=${{ steps.calculate.outputs.task2_score || 0 }}
        TASK3_SCORE=${{ steps.calculate.outputs.task3_score || 0 }}
        TOTAL_SCORE=${{ steps.calculate.outputs.total_score || 0 }}
        MAX_SCORE=${{ steps.calculate.outputs.max_score || 110 }}

        # Ð Ð°ÑÑ‡ÐµÑ‚ Ð¿Ñ€Ð¾Ñ†ÐµÐ½Ñ‚Ð°
        if [ "$MAX_SCORE" -gt 0 ]; then
          PERCENTAGE=$((TOTAL_SCORE * 100 / MAX_SCORE))
        else
          PERCENTAGE=0
        fi

        # Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ð¾Ñ‚Ñ‡ÐµÑ‚Ð°
        echo "## ðŸ“Š Ð˜Ð¢ÐžÐ“ÐžÐ’Ð«Ð™ ÐžÐ¢Ð§Ð•Ð¢ ÐŸÐž Ð’Ð¡Ð•Ðœ Ð—ÐÐ”ÐÐÐ˜Ð¯Ðœ" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY

        echo "### ðŸ“ˆ Ð¡Ð²Ð¾Ð´Ð½Ð°Ñ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ð°" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "| Ð—Ð°Ð´Ð°Ð½Ð¸Ðµ | Ð‘Ð°Ð»Ð»Ñ‹ | ÐœÐ°ÐºÑÐ¸Ð¼ÑƒÐ¼ | Ð¡Ñ‚Ð°Ñ‚ÑƒÑ |" >> $GITHUB_STEP_SUMMARY
        echo "|---------|-------|----------|--------|" >> $GITHUB_STEP_SUMMARY

        # Ð¡Ñ‚Ð°Ñ‚ÑƒÑÑ‹ Ñ ÑƒÑÐ»Ð¾Ð²Ð¸ÑÐ¼Ð¸
        TASK1_STATUS="âŒ"
        if [ $TASK1_SCORE -ge 25 ]; then
          TASK1_STATUS="âœ…"
        elif [ $TASK1_SCORE -ge 15 ]; then
          TASK1_STATUS="âš ï¸"
        fi

        TASK2_STATUS="âŒ"
        if [ $TASK2_SCORE -ge 32 ]; then
          TASK2_STATUS="âœ…"
        elif [ $TASK2_SCORE -ge 20 ]; then
          TASK2_STATUS="âš ï¸"
        fi

        TASK3_STATUS="âŒ"
        if [ $TASK3_SCORE -ge 32 ]; then
          TASK3_STATUS="âœ…"
        elif [ $TASK3_SCORE -ge 20 ]; then
          TASK3_STATUS="âš ï¸"
        fi

        echo "| **Ð—Ð°Ð´Ð°Ñ‡Ð° 1: ÐšÐ°Ð»ÑŒÐºÑƒÐ»ÑÑ‚Ð¾Ñ€** | $TASK1_SCORE | 30 | $TASK1_STATUS |" >> $GITHUB_STEP_SUMMARY
        echo "| **Ð—Ð°Ð´Ð°Ñ‡Ð° 2: ÐŸÐ°Ð»Ð¸Ð½Ð´Ñ€Ð¾Ð¼** | $TASK2_SCORE | 40 | $TASK2_STATUS |" >> $GITHUB_STEP_SUMMARY
        echo "| **Ð—Ð°Ð´Ð°Ñ‡Ð° 3: Ð§Ð¸ÑÐ»Ð° Ð¤Ð¸Ð±Ð¾Ð½Ð°Ñ‡Ñ‡Ð¸** | $TASK3_SCORE | 40 | $TASK3_STATUS |" >> $GITHUB_STEP_SUMMARY
        echo "| **Ð’Ð¡Ð•Ð“Ðž** | **$TOTAL_SCORE** | **$MAX_SCORE** | **$PERCENTAGE%** |" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY

        echo "### ðŸ“ ÐÐ°Ð¹Ð´ÐµÐ½Ð½Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹:" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY

        # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ„Ð°Ð¹Ð»Ð¾Ð²
        for file in task_01.py task_02.py task_03.py; do
          if [ -f "$file" ]; then
            echo "âœ… **$file** - Ð½Ð°Ð¹Ð´ÐµÐ½" >> $GITHUB_STEP_SUMMARY
          else
            echo "âŒ **$file** - Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½" >> $GITHUB_STEP_SUMMARY
          fi
        done

        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ðŸ† Ð˜Ñ‚Ð¾Ð³Ð¾Ð²Ð°Ñ Ð¾Ñ†ÐµÐ½ÐºÐ°: **$TOTAL_SCORE / $MAX_SCORE**" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY

        # Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸
        if [ "$TOTAL_SCORE" -eq "$MAX_SCORE" ]; then
          echo "ðŸŽ‰ **ÐŸÐžÐ—Ð”Ð ÐÐ’Ð›Ð¯Ð•Ðœ! Ð’ÑÐµ Ð·Ð°Ð´Ð°Ñ‡Ð¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ñ‹ Ð½Ð° 100%!**" >> $GITHUB_STEP_SUMMARY
        elif [ "$PERCENTAGE" -ge 80 ]; then
          echo "ðŸ‘ **ÐžÑ‚Ð»Ð¸Ñ‡Ð½Ñ‹Ð¹ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚! ÐŸÐ¾Ñ‡Ñ‚Ð¸ Ð²ÑÐµ Ð·Ð°Ð´Ð°Ñ‡Ð¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ñ‹.**" >> $GITHUB_STEP_SUMMARY
        elif [ "$PERCENTAGE" -ge 60 ]; then
          echo "âš ï¸ **Ð¥Ð¾Ñ€Ð¾ÑˆÐ°Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ð°, Ð½Ð¾ ÐµÑÑ‚ÑŒ ÐºÑƒÐ´Ð° Ñ€Ð°ÑÑ‚Ð¸.**" >> $GITHUB_STEP_SUMMARY
        else
          echo "âŒ **ÐÑƒÐ¶Ð½Ð¾ ÑÐµÑ€ÑŒÐµÐ·Ð½Ð¾ Ð¿Ð¾Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ Ð½Ð°Ð´ Ð·Ð°Ð´Ð°Ð½Ð¸ÑÐ¼Ð¸.**" >> $GITHUB_STEP_SUMMARY
        fi

        echo "" >> $GITHUB_STEP_SUMMARY
        echo "*ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°* â€¢ $(date)" >> $GITHUB_STEP_SUMMARY

    - name: Report to GitHub Classroom
      uses: classroom-resources/autograding-grading-reporter@v1
      with:
        # Ð¤ÐžÐ ÐœÐÐ¢: "runner1:score1,runner2:score2,runner3:score3"
        runners: "task_01:${{ steps.calculate.outputs.task1_score }},task_02:${{ steps.calculate.outputs.task2_score }},task_03:${{ steps.calculate.outputs.task3_score }}"
        #  task_01:${{ steps.calculate.outputs.task1_score || 0 }},task_02:${{ steps.calculate.outputs.task2_score || 0 }},task_03:${{ steps.calculate.outputs.task3_score || 0 }}
        
  # JOB: ÐÐÐÐ›Ð˜Ð— ÐšÐÐ§Ð•Ð¡Ð¢Ð’Ð ÐšÐžÐ”Ð Ð¡ Ð›Ð˜ÐÐ¢Ð•Ð ÐÐœÐ˜
  code-quality-analysis:
    name: ÐÐ½Ð°Ð»Ð¸Ð· ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð° ÐºÐ¾Ð´Ð°
    runs-on: ubuntu-latest
    if: always()
    
    steps:
    - uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: "3.10"

    - name: Install linters
      run: |
        echo "Installing linters..."
        pip install pylint flake8 ruff -q
        echo "Linters installed"

    - name: Run code analysis
      run: |
        # Ð¢Ð¾Ð»ÑŒÐºÐ¾ Python ÑÐºÑ€Ð¸Ð¿Ñ‚, Ð±ÐµÐ· Ð»Ð¸ÑˆÐ½Ð¸Ñ… echo
        python3 tools/code_analysis.py >> $GITHUB_STEP_SUMMARY
        
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ðŸ’¡ Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸ Ð¿Ð¾ ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¸ÑŽ:" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "1. **Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ruff:**" >> $GITHUB_STEP_SUMMARY
        echo '   ```bash' >> $GITHUB_STEP_SUMMARY
        echo '   ruff check --fix .' >> $GITHUB_STEP_SUMMARY
        echo '   ```' >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "2. **Ð¡Ð»ÐµÐ´ÑƒÐ¹Ñ‚Ðµ PEP 8:** 4 Ð¿Ñ€Ð¾Ð±ÐµÐ»Ð° Ð´Ð»Ñ Ð¾Ñ‚ÑÑ‚ÑƒÐ¿Ð¾Ð², Ð¼Ð°ÐºÑÐ¸Ð¼ÑƒÐ¼ 79 ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð² Ð² ÑÑ‚Ñ€Ð¾ÐºÐµ" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "3. **ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐ¹Ñ‚Ðµ ÐºÐ¾Ð´ Ð¿ÐµÑ€ÐµÐ´ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¾Ð¹**" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "*ÐšÐ°Ñ‡ÐµÑÑ‚Ð²Ð¾ ÐºÐ¾Ð´Ð° ÑƒÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ð¿Ñ€Ð¸ Ð¾Ñ†ÐµÐ½ÐºÐµ!*" >> $GITHUB_STEP_SUMMARY
