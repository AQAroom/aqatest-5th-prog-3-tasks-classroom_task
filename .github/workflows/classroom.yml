name: Autograding Tests
on:
  - push
  - repository_dispatch
permissions:
  checks: write
  actions: read
  contents: read

jobs:
  # JOB 1: Ð—Ð°Ð¿ÑƒÑÐº Ñ‚ÐµÑÑ‚Ð¾Ð² Ð¸ Ð°Ð³Ñ€ÐµÐ³Ð°Ñ†Ð¸Ñ
  run-autograding-tests:
    name: ÐžÑ†ÐµÐ½Ð¸Ð²Ð°Ð½Ð¸Ðµ Ð·Ð°Ð´Ð°Ð½Ð¸Ð¹
    runs-on: ubuntu-latest
    if: github.actor != 'github-classroom[bot]'
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.x'
    
    # ============ Ð—ÐÐŸÐ£Ð¡Ðš Ð¢Ð•Ð¡Ð¢ÐžÐ’ ============
    # ============ Ð—ÐÐ”ÐÐ§Ð 1: ÐšÐÐ›Ð¬ÐšÐ£Ð›Ð¯Ð¢ÐžÐ  ============
    - name: "[TASK 1] Ð¡Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ"
      id: task1_add
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: "Ð—Ð°Ð´Ð°Ñ‡Ð° 1: Ð¡Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ"
        command: python task_01.py
        input: |
          5
          +
          3
        expected-output: '8'
        comparison-method: exact
        timeout: 5
        max-score: 10
    
    - name: "[TASK 1] Ð’Ñ‹Ñ‡Ð¸Ñ‚Ð°Ð½Ð¸Ðµ"
      id: task1_sub
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: "Ð—Ð°Ð´Ð°Ñ‡Ð° 1: Ð’Ñ‹Ñ‡Ð¸Ñ‚Ð°Ð½Ð¸Ðµ"
        command: python task_01.py
        input: |
          10
          -
          4
        expected-output: '6'
        comparison-method: exact
        timeout: 5
        max-score: 10
    
    - name: "[TASK 1] Ð”ÐµÐ»ÐµÐ½Ð¸Ðµ Ð½Ð° Ð½Ð¾Ð»ÑŒ"
      id: task1_div_zero
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: "Ð—Ð°Ð´Ð°Ñ‡Ð° 1: Ð”ÐµÐ»ÐµÐ½Ð¸Ðµ Ð½Ð° Ð½Ð¾Ð»ÑŒ"
        command: python task_01.py
        input: |
          10
          /
          0
        expected-output: 'error'
        comparison-method: contains
        timeout: 5
        max-score: 10
    
    # ============ Ð—ÐÐ”ÐÐ§Ð 2: ÐŸÐÐ›Ð˜ÐÐ”Ð ÐžÐœ ============
    - name: "[TASK 2] ÐŸÑ€Ð¾ÑÑ‚Ð¾Ð¹ Ð¿Ð°Ð»Ð¸Ð½Ð´Ñ€Ð¾Ð¼"
      id: task2_text_en
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: "Ð—Ð°Ð´Ð°Ñ‡Ð° 2: ÐŸÑ€Ð¾ÑÑ‚Ð¾Ð¹ Ð¿Ð°Ð»Ð¸Ð½Ð´Ñ€Ð¾Ð¼"
        command: python task_02.py
        input: "racecar"
        expected-output: 'True'
        comparison-method: exact
        timeout: 5
        max-score: 15
    
    - name: "[TASK 2] ÐÐµ Ð¿Ð°Ð»Ð¸Ð½Ð´Ñ€Ð¾Ð¼"
      id: task2_not_palindrome
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: "Ð—Ð°Ð´Ð°Ñ‡Ð° 2: ÐÐµ Ð¿Ð°Ð»Ð¸Ð½Ð´Ñ€Ð¾Ð¼"
        command: python task_02.py
        input: "hello"
        expected-output: 'False'
        comparison-method: exact
        timeout: 5
        max-score: 15
    
    - name: "[TASK 2] ÐŸÑƒÑÑ‚Ð°Ñ ÑÑ‚Ñ€Ð¾ÐºÐ°"
      id: task2_text_ru
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: "Ð—Ð°Ð´Ð°Ñ‡Ð° 2: ÐŸÑƒÑÑ‚Ð°Ñ ÑÑ‚Ñ€Ð¾ÐºÐ°"
        command: python task_02.py
        input: "Ð°Ñ€Ð¾Ð·Ð°ÑƒÐ¿Ð°Ð»Ð°Ð½Ð°Ð»Ð°Ð¿ÑƒÐ°Ð·Ð¾Ñ€Ð°"
        expected-output: 'True'
        comparison-method: exact
        timeout: 5
        max-score: 10
    
    # ============ Ð—ÐÐ”ÐÐ§Ð 3: Ð¤Ð˜Ð‘ÐžÐÐÐ§Ð§Ð˜ ============
    - name: "[TASK 3] Fibonacci(0)"
      id: task3_fib0
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: "Ð—Ð°Ð´Ð°Ñ‡Ð° 3: Fibonacci(0)"
        command: python task_03.py
        input: "0"
        expected-output: '0'
        comparison-method: exact
        timeout: 5
        max-score: 10
    
    - name: "[TASK 3] Fibonacci(1)"
      id: task3_fib1
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: "Ð—Ð°Ð´Ð°Ñ‡Ð° 3: Fibonacci(1)"
        command: python task_03.py
        input: "1"
        expected-output: '1'
        comparison-method: exact
        timeout: 5
        max-score: 10
    
    - name: "[TASK 3] Fibonacci(10)"
      id: task3_fib10
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: "Ð—Ð°Ð´Ð°Ñ‡Ð° 3: Fibonacci(10)"
        command: python task_03.py
        input: "10"
        expected-output: '55'
        comparison-method: exact
        timeout: 5
        max-score: 20

    - name: Debug Test Results
      run: |
        echo "=== ÐŸÐ ÐžÐ’Ð•Ð ÐšÐ Ð Ð•Ð—Ð£Ð›Ð¬Ð¢ÐÐ¢ÐžÐ’ Ð¢Ð•Ð¡Ð¢ÐžÐ’ ==="
        
        echo ""
        echo "1. task1_add:"
        python3 tools/check_json.py "${{ steps.task1_add.outputs.result || 'NOT_SET' }}" "task1_add"
        
        echo ""
        echo "2. task1_sub:"
        python3 tools/check_json.py "${{ steps.task1_sub.outputs.result || 'NOT_SET' }}" "task1_sub"

    # ============ ÐÐ“Ð Ð•Ð“ÐÐ¦Ð˜Ð¯ Ð Ð•Ð—Ð£Ð›Ð¬Ð¢ÐÐ¢ÐžÐ’ ============
    - name: Aggregate Task 1 Results
      id: aggregate_task1
      run: |
        echo "ÐÐ³Ñ€ÐµÐ³Ð¸Ñ€ÑƒÐµÐ¼ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð·Ð°Ð´Ð°Ñ‡Ð¸ 1..."
        python3 tools/aggregate_results.py \
          "Ð—Ð°Ð´Ð°Ñ‡Ð° 1: ÐšÐ°Ð»ÑŒÐºÑƒÐ»ÑÑ‚Ð¾Ñ€" \
          30 \
          "${{ steps.task1_add.outputs.result }}" \
          "${{ steps.task1_sub.outputs.result }}" \
          "${{ steps.task1_div_zero.outputs.result }}" > task1_aggregated.txt
        
        AGG_RESULT=$(grep -oP 'AGGREGATED_RESULT=\K.+' task1_aggregated.txt)
        echo "task1_aggregated=$AGG_RESULT" >> $GITHUB_OUTPUT
        
        echo "Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð°Ð³Ñ€ÐµÐ³Ð°Ñ†Ð¸Ð¸ Ð·Ð°Ð´Ð°Ñ‡Ð¸ 1:"
        echo "$AGG_RESULT" | base64 -d | python3 -m json.tool 2>/dev/null || echo "ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð´ÐµÐºÐ¾Ð´Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ JSON"
    
    - name: Aggregate Task 2 Results
      id: aggregate_task2
      run: |
        echo "ÐÐ³Ñ€ÐµÐ³Ð¸Ñ€ÑƒÐµÐ¼ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð·Ð°Ð´Ð°Ñ‡Ð¸ 2..."
        python3 tools/aggregate_results.py \
          "Ð—Ð°Ð´Ð°Ñ‡Ð° 2: ÐŸÐ°Ð»Ð¸Ð½Ð´Ñ€Ð¾Ð¼" \
          40 \
          "${{ steps.task2_text_en.outputs.result }}" \
          "${{ steps.task2_not_palindrome.outputs.result }}" \
          "${{ steps.task2_text_ru.outputs.result }}" > task2_aggregated.txt
        
        AGG_RESULT=$(grep -oP 'AGGREGATED_RESULT=\K.+' task2_aggregated.txt)
        echo "task2_aggregated=$AGG_RESULT" >> $GITHUB_OUTPUT
        
        echo "Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð°Ð³Ñ€ÐµÐ³Ð°Ñ†Ð¸Ð¸ Ð·Ð°Ð´Ð°Ñ‡Ð¸ 2:"
        echo "$AGG_RESULT" | base64 -d | python3 -m json.tool 2>/dev/null || echo "ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð´ÐµÐºÐ¾Ð´Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ JSON"
    
    - name: Aggregate Task 3 Results
      id: aggregate_task3
      run: |
        echo "ÐÐ³Ñ€ÐµÐ³Ð¸Ñ€ÑƒÐµÐ¼ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð·Ð°Ð´Ð°Ñ‡Ð¸ 3..."
        python3 tools/aggregate_results.py \
          "Ð—Ð°Ð´Ð°Ñ‡Ð° 3: Ð§Ð¸ÑÐ»Ð° Ð¤Ð¸Ð±Ð¾Ð½Ð°Ñ‡Ñ‡Ð¸" \
          40 \
          "${{ steps.task3_fib0.outputs.result }}" \
          "${{ steps.task3_fib1.outputs.result }}" \
          "${{ steps.task3_fib10.outputs.result }}" > task3_aggregated.txt
        
        AGG_RESULT=$(grep -oP 'AGGREGATED_RESULT=\K.+' task3_aggregated.txt)
        echo "task3_aggregated=$AGG_RESULT" >> $GITHUB_OUTPUT
        
        echo "Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð°Ð³Ñ€ÐµÐ³Ð°Ñ†Ð¸Ð¸ Ð·Ð°Ð´Ð°Ñ‡Ð¸ 3:"
        echo "$AGG_RESULT" | base64 -d | python3 -m json.tool 2>/dev/null || echo "ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð´ÐµÐºÐ¾Ð´Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ JSON"
    
    # ============ ÐŸÐ ÐžÐ’Ð•Ð ÐšÐ Ð¤ÐÐ™Ð›ÐžÐ’ ============
    - name: Debug Aggregated Results
      run: |
        echo "=== ÐŸÐ ÐžÐ’Ð•Ð ÐšÐ Ð¤ÐÐ™Ð›ÐžÐ’ ==="
        
        # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ð¹ Python ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸
        python3 tools/check_file_tasks.py

    # ============ Ð¡ÐžÐ¥Ð ÐÐÐ•ÐÐ˜Ð• Ð Ð•Ð—Ð£Ð›Ð¬Ð¢ÐÐ¢ÐžÐ’ ============
    - name: Save Aggregated Results
      uses: actions/upload-artifact@v4
      with:
        name: aggregated-results
        path: |
          task1_aggregated.txt
          task2_aggregated.txt
          task3_aggregated.txt
        retention-days: 1
    
    # ============ ÐŸÐÐ Ð¡Ð˜ÐÐ“ Ð‘ÐÐ›Ð›ÐžÐ’ Ð”Ð›Ð¯ ÐžÐ¢Ð§Ð•Ð¢Ð ============
    - name: Parse Scores for Report
      id: parse_scores
      run: |
        python3 tools/parse_scores.py 1 \
          "${{ steps.task1_add.outputs.result }}" \
          "${{ steps.task1_sub.outputs.result }}" \
          "${{ steps.task1_div_zero.outputs.result }}" > task1_score.txt
        
        python3 tools/parse_scores.py 2 \
          "${{ steps.task2_text_en.outputs.result }}" \
          "${{ steps.task2_not_palindrome.outputs.result }}" \
          "${{ steps.task2_text_ru.outputs.result }}" > task2_score.txt
        
        python3 tools/parse_scores.py 3 \
          "${{ steps.task3_fib0.outputs.result }}" \
          "${{ steps.task3_fib1.outputs.result }}" \
          "${{ steps.task3_fib10.outputs.result }}" > task3_score.txt
        
        # Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð±Ð°Ð»Ð»Ñ‹ Ð² outputs
        TASK1=$(grep -oP 'TASK_SCORE=\K\d+' task1_score.txt)
        TASK2=$(grep -oP 'TASK_SCORE=\K\d+' task2_score.txt)
        TASK3=$(grep -oP 'TASK_SCORE=\K\d+' task3_score.txt)
        
        echo "task1_score=$TASK1" >> $GITHUB_OUTPUT
        echo "task2_score=$TASK2" >> $GITHUB_OUTPUT
        echo "task3_score=$TASK3" >> $GITHUB_OUTPUT
        echo "total_score=$(($TASK1 + $TASK2 + $TASK3))" >> $GITHUB_OUTPUT

  # JOB 2: Ð¤Ð˜ÐÐÐ›Ð¬ÐÐ«Ð™ ÐžÐ¢Ð§Ð•Ð¢ Ð˜ ÐžÐ¢ÐŸÐ ÐÐ’ÐšÐ Ð’ CLASSROOM
  generate-final-report:
    name: Ð˜Ñ‚Ð¾Ð³Ð¾Ð²Ñ‹Ð¹ Ð¾Ñ‚Ñ‡ÐµÑ‚ Ð¸ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ°
    runs-on: ubuntu-latest
    needs: run-autograding-tests
    if: always()
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Download Aggregated Results
      uses: actions/download-artifact@v4
      with:
        name: aggregated-results
        path: ./aggregated
    
    - name: Extract Aggregated Results
      id: extract_results
      run: |
        echo "Ð˜Ð·Ð²Ð»ÐµÐºÐ°ÐµÐ¼ Ð°Ð³Ñ€ÐµÐ³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹..."
        
        # Ð—Ð°Ð´Ð°Ñ‡Ð° 1
        TASK1_AGG=$(grep -oP 'AGGREGATED_RESULT=\K.+' ./aggregated/task1_aggregated.txt 2>/dev/null || echo "")
        echo "task1_aggregated=$TASK1_AGG" >> $GITHUB_OUTPUT
        
        # Ð—Ð°Ð´Ð°Ñ‡Ð° 2
        TASK2_AGG=$(grep -oP 'AGGREGATED_RESULT=\K.+' ./aggregated/task2_aggregated.txt 2>/dev/null || echo "")
        echo "task2_aggregated=$TASK2_AGG" >> $GITHUB_OUTPUT
        
        # Ð—Ð°Ð´Ð°Ñ‡Ð° 3
        TASK3_AGG=$(grep -oP 'AGGREGATED_RESULT=\K.+' ./aggregated/task3_aggregated.txt 2>/dev/null || echo "")
        echo "task3_aggregated=$TASK3_AGG" >> $GITHUB_OUTPUT
        
        echo "Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð¸Ð·Ð²Ð»ÐµÑ‡ÐµÐ½Ñ‹"
    
    # ============ ÐžÐ¢ÐŸÐ ÐÐ’ÐšÐ Ð’ GITHUB CLASSROOM ============
    - name: Report to GitHub Classroom
      uses: classroom-resources/autograding-grading-reporter@v1
      env:
        TASK_01_RESULTS: "${{ steps.extract_results.outputs.task1_aggregated }}"
        TASK_02_RESULTS: "${{ steps.extract_results.outputs.task2_aggregated }}"
        TASK_03_RESULTS: "${{ steps.extract_results.outputs.task3_aggregated }}"
      with:
        runners: "task_01,task_02,task_03"
    
    # ============ Ð“Ð•ÐÐ•Ð ÐÐ¦Ð˜Ð¯ ÐžÐ¢Ð§Ð•Ð¢Ð ============
    - name: Generate Final Summary
      run: |
        # Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Ñ€ÐµÐ°Ð»ÑŒÐ½Ñ‹Ðµ Ð±Ð°Ð»Ð»Ñ‹ Ð¸Ð· Ð°Ð³Ñ€ÐµÐ³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð²
        TASK1_SCORE=0
        TASK2_SCORE=0
        TASK3_SCORE=0
        
        # Ð˜Ð·Ð²Ð»ÐµÐºÐ°ÐµÐ¼ Ð±Ð°Ð»Ð»Ñ‹ Ð¸Ð· Ð°Ð³Ñ€ÐµÐ³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð²
        if [ -f "./aggregated/task1_aggregated.txt" ]; then
          TASK1_JSON=$(grep -oP 'AGGREGATED_RESULT=\K.+' ./aggregated/task1_aggregated.txt 2>/dev/null | base64 -d 2>/dev/null || echo "{}")
          TASK1_SCORE=$(echo "$TASK1_JSON" | python3 -c "import json, sys; data=json.load(sys.stdin) if sys.stdin.read() else {}; print(data.get('tests', [{}])[0].get('score', 0))" 2>/dev/null || echo "0")
        fi
        
        if [ -f "./aggregated/task2_aggregated.txt" ]; then
          TASK2_JSON=$(grep -oP 'AGGREGATED_RESULT=\K.+' ./aggregated/task2_aggregated.txt 2>/dev/null | base64 -d 2>/dev/null || echo "{}")
          TASK2_SCORE=$(echo "$TASK2_JSON" | python3 -c "import json, sys; data=json.load(sys.stdin) if sys.stdin.read() else {}; print(data.get('tests', [{}])[0].get('score', 0))" 2>/dev/null || echo "0")
        fi
        
        if [ -f "./aggregated/task3_aggregated.txt" ]; then
          TASK3_JSON=$(grep -oP 'AGGREGATED_RESULT=\K.+' ./aggregated/task3_aggregated.txt 2>/dev/null | base64 -d 2>/dev/null || echo "{}")
          TASK3_SCORE=$(echo "$TASK3_JSON" | python3 -c "import json, sys; data=json.load(sys.stdin) if sys.stdin.read() else {}; print(data.get('tests', [{}])[0].get('score', 0))" 2>/dev/null || echo "0")
        fi
        
        # Ð•ÑÐ»Ð¸ Ð½Ðµ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ð»Ð¾ÑÑŒ Ð¸Ð· Ñ„Ð°Ð¹Ð»Ð¾Ð², Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ Ð¸Ð· Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÐµÐ³Ð¾ job
        if [ "$TASK1_SCORE" -eq 0 ]; then
          TASK1_SCORE=${{ needs.run-autograding-tests.outputs.task1_score || 0 }}
        fi
        if [ "$TASK2_SCORE" -eq 0 ]; then
          TASK2_SCORE=${{ needs.run-autograding-tests.outputs.task2_score || 0 }}
        fi
        if [ "$TASK3_SCORE" -eq 0 ]; then
          TASK3_SCORE=${{ needs.run-autograding-tests.outputs.task3_score || 0 }}
        fi
        
        TOTAL_SCORE=$((TASK1_SCORE + TASK2_SCORE + TASK3_SCORE))
        MAX_SCORE=110
        
        echo "## ðŸ“Š Ð˜Ð¢ÐžÐ“ÐžÐ’Ð«Ð™ ÐžÐ¢Ð§Ð•Ð¢ ÐŸÐž Ð’Ð¡Ð•Ðœ Ð—ÐÐ”ÐÐÐ˜Ð¯Ðœ" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ðŸ“ˆ Ð¡Ð²Ð¾Ð´Ð½Ð°Ñ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ð°" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "| Ð—Ð°Ð´Ð°Ð½Ð¸Ðµ | Ð‘Ð°Ð»Ð»Ñ‹ | ÐœÐ°ÐºÑÐ¸Ð¼ÑƒÐ¼ | Ð¡Ñ‚Ð°Ñ‚ÑƒÑ |" >> $GITHUB_STEP_SUMMARY
        echo "|---------|-------|----------|--------|" >> $GITHUB_STEP_SUMMARY
        
        # Ð¡Ñ‚Ð°Ñ‚ÑƒÑÑ‹ Ñ ÑƒÑÐ»Ð¾Ð²Ð¸ÑÐ¼Ð¸
        TASK1_STATUS="âŒ"
        if [ $TASK1_SCORE -ge 25 ]; then
          TASK1_STATUS="âœ…"
        elif [ $TASK1_SCORE -ge 15 ]; then
          TASK1_STATUS="âš ï¸"
        fi
        
        TASK2_STATUS="âŒ"
        if [ $TASK2_SCORE -ge 32 ]; then
          TASK2_STATUS="âœ…"
        elif [ $TASK2_SCORE -ge 20 ]; then
          TASK2_STATUS="âš ï¸"
        fi
        
        TASK3_STATUS="âŒ"
        if [ $TASK3_SCORE -ge 32 ]; then
          TASK3_STATUS="âœ…"
        elif [ $TASK3_SCORE -ge 20 ]; then
          TASK3_STATUS="âš ï¸"
        fi
        
        echo "| **Ð—Ð°Ð´Ð°Ñ‡Ð° 1: ÐšÐ°Ð»ÑŒÐºÑƒÐ»ÑÑ‚Ð¾Ñ€** | $TASK1_SCORE | 30 | $TASK1_STATUS |" >> $GITHUB_STEP_SUMMARY
        echo "| **Ð—Ð°Ð´Ð°Ñ‡Ð° 2: ÐŸÐ°Ð»Ð¸Ð½Ð´Ñ€Ð¾Ð¼** | $TASK2_SCORE | 40 | $TASK2_STATUS |" >> $GITHUB_STEP_SUMMARY
        echo "| **Ð—Ð°Ð´Ð°Ñ‡Ð° 3: Ð§Ð¸ÑÐ»Ð° Ð¤Ð¸Ð±Ð¾Ð½Ð°Ñ‡Ñ‡Ð¸** | $TASK3_SCORE | 40 | $TASK3_STATUS |" >> $GITHUB_STEP_SUMMARY
        echo "| **Ð’Ð¡Ð•Ð“Ðž** | **$TOTAL_SCORE** | **$MAX_SCORE** | **$((TOTAL_SCORE * 100 / MAX_SCORE))%** |" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        echo "### ðŸ“ ÐÐ°Ð¹Ð´ÐµÐ½Ð½Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹:" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ„Ð°Ð¹Ð»Ð¾Ð²
        for file in task_01.py task_02.py task_03.py; do
          if [ -f "$file" ]; then
            echo "âœ… **$file** - Ð½Ð°Ð¹Ð´ÐµÐ½" >> $GITHUB_STEP_SUMMARY
          else
            echo "âŒ **$file** - Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½" >> $GITHUB_STEP_SUMMARY
          fi
        done
        
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ðŸ† Ð˜Ñ‚Ð¾Ð³Ð¾Ð²Ð°Ñ Ð¾Ñ†ÐµÐ½ÐºÐ°: **$TOTAL_SCORE / $MAX_SCORE**" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        # Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸
        if [ "$TOTAL_SCORE" -eq "$MAX_SCORE" ]; then
          echo "ðŸŽ‰ **ÐŸÐžÐ—Ð”Ð ÐÐ’Ð›Ð¯Ð•Ðœ! Ð’ÑÐµ Ð·Ð°Ð´Ð°Ñ‡Ð¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ñ‹ Ð½Ð° 100%!**" >> $GITHUB_STEP_SUMMARY
        elif [ "$PERCENTAGE" -ge 80 ]; then
          echo "ðŸ‘ **ÐžÑ‚Ð»Ð¸Ñ‡Ð½Ñ‹Ð¹ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚! ÐŸÐ¾Ñ‡Ñ‚Ð¸ Ð²ÑÐµ Ð·Ð°Ð´Ð°Ñ‡Ð¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ñ‹.**" >> $GITHUB_STEP_SUMMARY
        elif [ "$PERCENTAGE" -ge 60 ]; then
          echo "âš ï¸ **Ð¥Ð¾Ñ€Ð¾ÑˆÐ°Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ð°, Ð½Ð¾ ÐµÑÑ‚ÑŒ ÐºÑƒÐ´Ð° Ñ€Ð°ÑÑ‚Ð¸.**" >> $GITHUB_STEP_SUMMARY
        else
          echo "âŒ **ÐÑƒÐ¶Ð½Ð¾ ÑÐµÑ€ÑŒÐµÐ·Ð½Ð¾ Ð¿Ð¾Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ Ð½Ð°Ð´ Ð·Ð°Ð´Ð°Ð½Ð¸ÑÐ¼Ð¸.**" >> $GITHUB_STEP_SUMMARY
        fi
        
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "*ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°* â€¢ $(date)" >> $GITHUB_STEP_SUMMARY

# JOB 3: ÐÐÐÐ›Ð˜Ð— ÐšÐÐ§Ð•Ð¡Ð¢Ð’Ð ÐšÐžÐ”Ð Ð¡ Ð›Ð˜ÐÐ¢Ð•Ð ÐÐœÐ˜
  code-quality-analysis:
    name: ÐÐ½Ð°Ð»Ð¸Ð· ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð° ÐºÐ¾Ð´Ð°
    runs-on: ubuntu-latest
    if: always()
    
    steps:
    - uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: "3.10"

    - name: Install linters
      run: |
        pip install pylint flake8 ruff -q

    - name: Run code analysis
      run: |
        python3 tools/code_analysis.py >> $GITHUB_STEP_SUMMARY
