name: Autograding Tests
'on':
  - push
  - repository_dispatch
permissions:
  checks: write
  actions: read
  contents: read

jobs:
  # JOB: –û–¶–ï–ù–ö–ê –ó–ê–î–ê–ù–ò–ô (3 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–∫–∏)
  grade-tasks:
    name: –û—Ü–µ–Ω–∏–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–¥–∞—á
    runs-on: ubuntu-latest
    if: github.actor != 'github-classroom[bot]'
    
    strategy:
      matrix:
        task: [1, 2, 3]
      max-parallel: 3
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.x'
    
    # ============ –ó–ê–î–ê–ß–ê 1: –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–† ============
    - name: "[TASK 1] –°–ª–æ–∂–µ–Ω–∏–µ"
      if: matrix.task == 1
      id: task1_add
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: "–ó–∞–¥–∞—á–∞ 1: –°–ª–æ–∂–µ–Ω–∏–µ"
        command: python task_01.py
        input: |
          5
          +
          3
        expected-output: '8'
        comparison-method: exact
        timeout: 5
        max-score: 10
    
    - name: "[TASK 1] –í—ã—á–∏—Ç–∞–Ω–∏–µ"
      if: matrix.task == 1
      id: task1_sub
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: "–ó–∞–¥–∞—á–∞ 1: –í—ã—á–∏—Ç–∞–Ω–∏–µ"
        command: python task_01.py
        input: |
          10
          -
          4
        expected-output: '6'
        comparison-method: exact
        timeout: 5
        max-score: 10
    
    - name: "[TASK 1] –î–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å"
      if: matrix.task == 1
      id: task1_div_zero
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: "–ó–∞–¥–∞—á–∞ 1: –î–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å"
        command: python task_01.py
        input: |
          10
          /
          0
        expected-output: 'error'
        comparison-method: contains
        timeout: 5
        max-score: 10
    
    # ============ –ó–ê–î–ê–ß–ê 2: –ü–ê–õ–ò–ù–î–†–û–ú ============
    - name: "[TASK 2] –ü—Ä–æ—Å—Ç–æ–π –ø–∞–ª–∏–Ω–¥—Ä–æ–º"
      if: matrix.task == 2
      id: task2_simple
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: "–ó–∞–¥–∞—á–∞ 2: –ü—Ä–æ—Å—Ç–æ–π –ø–∞–ª–∏–Ω–¥—Ä–æ–º"
        command: python task_02.py
        input: "racecar"
        expected-output: 'True'
        comparison-method: exact
        timeout: 5
        max-score: 15
    
    - name: "[TASK 2] –ù–µ –ø–∞–ª–∏–Ω–¥—Ä–æ–º"
      if: matrix.task == 2
      id: task2_not_palindrome
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: "–ó–∞–¥–∞—á–∞ 2: –ù–µ –ø–∞–ª–∏–Ω–¥—Ä–æ–º"
        command: python task_02.py
        input: "hello"
        expected-output: 'False'
        comparison-method: exact
        timeout: 5
        max-score: 15
    
    - name: "[TASK 2] –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞"
      if: matrix.task == 2
      id: task2_empty
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: "–ó–∞–¥–∞—á–∞ 2: –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞"
        command: python task_02.py
        input: ""
        expected-output: 'True'
        comparison-method: exact
        timeout: 5
        max-score: 10
    
    # ============ –ó–ê–î–ê–ß–ê 3: –§–ò–ë–û–ù–ê–ß–ß–ò ============
    - name: "[TASK 3] Fibonacci(0)"
      if: matrix.task == 3
      id: task3_fib0
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: "–ó–∞–¥–∞—á–∞ 3: Fibonacci(0)"
        command: python task_03.py
        input: "0"
        expected-output: '0'
        comparison-method: exact
        timeout: 5
        max-score: 10
    
    - name: "[TASK 3] Fibonacci(1)"
      if: matrix.task == 3
      id: task3_fib1
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: "–ó–∞–¥–∞—á–∞ 3: Fibonacci(1)"
        command: python task_03.py
        input: "1"
        expected-output: '1'
        comparison-method: exact
        timeout: 5
        max-score: 10
    
    - name: "[TASK 3] Fibonacci(10)"
      if: matrix.task == 3
      id: task3_fib10
      uses: classroom-resources/autograding-io-grader@v1
      with:
        test-name: "–ó–∞–¥–∞—á–∞ 3: Fibonacci(10)"
        command: python task_03.py
        input: "10"
        expected-output: '55'
        comparison-method: exact
        timeout: 5
        max-score: 20
    
    # ============ –°–û–ë–ò–†–ê–ï–ú –†–ï–ó–£–õ–¨–¢–ê–¢–´ ============
    - name: Extract and Save Scores
      if: always()
      run: |
        echo "DEBUG: Starting score extraction for task ${{ matrix.task }}"
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤
        if [ "${{ matrix.task }}" = "1" ]; then
          echo "Task 1 results:"
          echo "task1_add: ${{ steps.task1_add.outputs.result }}"
          echo "task1_sub: ${{ steps.task1_sub.outputs.result }}"
          echo "task1_div_zero: ${{ steps.task1_div_zero.outputs.result }}"
          
          # –ü—Ä–æ–±—É–µ–º –∏–∑–≤–ª–µ—á—å –±–∞–ª–ª—ã –Ω–∞–ø—Ä—è–º—É—é
          python3 << 'EOF'
import sys
import json
import base64

def get_score(encoded_result):
    if not encoded_result or encoded_result == 'null':
        return 0
    try:
        # –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã
        decoded = base64.b64decode(encoded_result).decode('utf-8')
        print(f"DEBUG: Decoded result: {decoded[:200]}...")
        data = json.loads(decoded)
        
        # –§–æ—Ä–º–∞—Ç 1: {'tests': [{'score': X}]}
        if 'tests' in data and len(data['tests']) > 0:
            score = data['tests'][0].get('score', 0)
            print(f"DEBUG: Score from tests: {score}")
            return score
            
        # –§–æ—Ä–º–∞—Ç 2: {'score': X}
        elif 'score' in data:
            score = data['score']
            print(f"DEBUG: Score from root: {score}")
            return score
            
        # –§–æ—Ä–º–∞—Ç 3: {'result': {'score': X}}
        elif 'result' in data and 'score' in data['result']:
            score = data['result']['score']
            print(f"DEBUG: Score from result.score: {score}")
            return score
            
        else:
            print(f"DEBUG: Unknown format: {data}")
            return 0
            
    except Exception as e:
        print(f"DEBUG: Error: {e}")
        return 0

# –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
add_result = sys.argv[1]
sub_result = sys.argv[2]
div_zero_result = sys.argv[3]

add_score = get_score(add_result)
sub_score = get_score(sub_result)
div_zero_score = get_score(div_zero_result)

total = add_score + sub_score + div_zero_score

print(f"TASK1_TOTAL={total}")
print(f"TASK1_DETAILS=addition:{add_score},subtraction:{sub_score},division_by_zero:{div_zero_score}")
EOF "${{ steps.task1_add.outputs.result }}" "${{ steps.task1_sub.outputs.result }}" "${{ steps.task1_div_zero.outputs.result }}" > scores.txt
          
        elif [ "${{ matrix.task }}" = "2" ]; then
          python3 tools/extract_scores.py 2 \
            "${{ steps.task2_simple.outputs.result }}" \
            "${{ steps.task2_not_palindrome.outputs.result }}" \
            "${{ steps.task2_empty.outputs.result }}" > scores.txt
          
        elif [ "${{ matrix.task }}" = "3" ]; then
          python3 tools/extract_scores.py 3 \
            "${{ steps.task3_fib0.outputs.result }}" \
            "${{ steps.task3_fib1.outputs.result }}" \
            "${{ steps.task3_fib10.outputs.result }}" > scores.txt
        fi
        
        if [ -f scores.txt ]; then
          echo "Content of scores.txt:"
          cat scores.txt
          echo "Scores extracted for task ${{ matrix.task }}"
        else
          echo "No scores file created"
        fi
    
    - name: Upload Scores Artifact
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: scores-task-${{ matrix.task }}
        path: scores.txt

  # JOB: –°–ë–û–†–ö–ê –ò–¢–û–ì–û–í–û–ô –°–í–û–î–ö–ò
  generate-final-report:
    name: –ò—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞
    runs-on: ubuntu-latest
    needs: grade-tasks
    if: always()
    
    steps:
    - name: Download all score artifacts
      uses: actions/download-artifact@v4
      with:
        path: ./artifacts
        pattern: scores-task-*
        merge-multiple: true
    
    - name: Parse and Aggregate Scores
      id: aggregate
      run: |
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        TASK1_SCORE=0
        TASK2_SCORE=0
        TASK3_SCORE=0
        
        # –ü–∞—Ä—Å–∏–º –≤—Å–µ —Ñ–∞–π–ª—ã scores.txt
        for file in $(find ./artifacts -name "scores.txt"); do
          echo "Processing file: $file"
          
          while IFS= read -r line || [[ -n "$line" ]]; do
            if [[ "$line" =~ ^TASK1_TOTAL=([0-9]+)$ ]]; then
              TASK1_SCORE="${BASH_REMATCH[1]}"
              echo "Found TASK1_SCORE: $TASK1_SCORE"
            elif [[ "$line" =~ ^TASK2_TOTAL=([0-9]+)$ ]]; then
              TASK2_SCORE="${BASH_REMATCH[1]}"
              echo "Found TASK2_SCORE: $TASK2_SCORE"
            elif [[ "$line" =~ ^TASK3_TOTAL=([0-9]+)$ ]]; then
              TASK3_SCORE="${BASH_REMATCH[1]}"
              echo "Found TASK3_SCORE: $TASK3_SCORE"
            fi
          done < "$file"
        done
        
        # –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        TASK1_SCORE=${TASK1_SCORE:-0}
        TASK2_SCORE=${TASK2_SCORE:-0}
        TASK3_SCORE=${TASK3_SCORE:-0}
        
        # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –±–∞–ª–ª—ã
        TASK1_MAX=30
        TASK2_MAX=40
        TASK3_MAX=40
        
        TOTAL_SCORE=$((TASK1_SCORE + TASK2_SCORE + TASK3_SCORE))
        MAX_SCORE=$((TASK1_MAX + TASK2_MAX + TASK3_MAX))
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ outputs
        echo "task1_score=$TASK1_SCORE" >> $GITHUB_OUTPUT
        echo "task2_score=$TASK2_SCORE" >> $GITHUB_OUTPUT
        echo "task3_score=$TASK3_SCORE" >> $GITHUB_OUTPUT
        echo "total_score=$TOTAL_SCORE" >> $GITHUB_OUTPUT
        echo "max_score=$MAX_SCORE" >> $GITHUB_OUTPUT
    
    - name: Generate Final Summary
      run: |
        TASK1_SCORE=${{ steps.aggregate.outputs.task1_score || 0 }}
        TASK2_SCORE=${{ steps.aggregate.outputs.task2_score || 0 }}
        TASK3_SCORE=${{ steps.aggregate.outputs.task3_score || 0 }}
        TOTAL_SCORE=${{ steps.aggregate.outputs.total_score || 0 }}
        MAX_SCORE=${{ steps.aggregate.outputs.max_score || 110 }}
        
        # –†–∞—Å—á–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç–∞
        if [ "$MAX_SCORE" -gt 0 ]; then
          PERCENTAGE=$((TOTAL_SCORE * 100 / MAX_SCORE))
        else
          PERCENTAGE=0
        fi
        
        # –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
        get_task_status() {
          local score="$1"
          local max="$2"
          if [ "$max" -eq 0 ]; then
            echo "‚ùì"
          elif [ "$score" -eq "$max" ]; then
            echo "‚úÖ –û—Ç–ª–∏—á–Ω–æ"
          elif [ "$score" -ge $((max * 80 / 100)) ]; then
            echo "‚ö†Ô∏è –•–æ—Ä–æ—à–æ"
          elif [ "$score" -ge $((max * 60 / 100)) ]; then
            echo "‚ö†Ô∏è –£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ"
          else
            echo "‚ùå –ù–µ —Å–¥–∞–Ω–æ"
          fi
        }
        
        TASK1_STATUS=$(get_task_status "$TASK1_SCORE" 30)
        TASK2_STATUS=$(get_task_status "$TASK2_SCORE" 40)
        TASK3_STATUS=$(get_task_status "$TASK3_SCORE" 40)
        
        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞
        echo "## üìä –ò–¢–û–ì–û–í–´–ô –û–¢–ß–ï–¢ –ü–û –í–°–ï–ú –ó–ê–î–ê–ù–ò–Ø–ú" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        echo "### üìà –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "| –ó–∞–¥–∞–Ω–∏–µ | –ë–∞–ª–ª—ã | –ú–∞–∫—Å–∏–º—É–º | –°—Ç–∞—Ç—É—Å |" >> $GITHUB_STEP_SUMMARY
        echo "|---------|-------|----------|--------|" >> $GITHUB_STEP_SUMMARY
        echo "| **–ó–∞–¥–∞—á–∞ 1: –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä** | $TASK1_SCORE | 30 | $TASK1_STATUS |" >> $GITHUB_STEP_SUMMARY
        echo "| **–ó–∞–¥–∞—á–∞ 2: –ü–∞–ª–∏–Ω–¥—Ä–æ–º** | $TASK2_SCORE | 40 | $TASK2_STATUS |" >> $GITHUB_STEP_SUMMARY
        echo "| **–ó–∞–¥–∞—á–∞ 3: –ß–∏—Å–ª–∞ –§–∏–±–æ–Ω–∞—á—á–∏** | $TASK3_SCORE | 40 | $TASK3_STATUS |" >> $GITHUB_STEP_SUMMARY
        echo "| **–í–°–ï–ì–û** | **$TOTAL_SCORE** | **$MAX_SCORE** | **$PERCENTAGE%** |" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        # –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
        echo "### üìä –û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "<div style='background: #e1e4e8; border-radius: 4px; height: 24px; width: 100%; margin: 10px 0;'>" >> $GITHUB_STEP_SUMMARY
        echo "  <div style='background: #2ea44f; border-radius: 4px; height: 100%; width: $PERCENTAGE%; text-align: center; color: white; font-weight: bold; line-height: 24px;'>" >> $GITHUB_STEP_SUMMARY
        echo "    $PERCENTAGE%" >> $GITHUB_STEP_SUMMARY
        echo "  </div>" >> $GITHUB_STEP_SUMMARY
        echo "</div>" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        # –§–∏–Ω–∞–ª
        echo "### üèÜ –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞: **$TOTAL_SCORE / $MAX_SCORE**" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        if [ "$TOTAL_SCORE" -eq "$MAX_SCORE" ]; then
          echo "üéâ **–ü–û–ó–î–†–ê–í–õ–Ø–ï–ú! –í—Å–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –Ω–∞ 100%!**" >> $GITHUB_STEP_SUMMARY
        elif [ "$PERCENTAGE" -ge 80 ]; then
          echo "üëç **–û—Ç–ª–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç! –ü–æ—á—Ç–∏ –≤—Å–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã.**" >> $GITHUB_STEP_SUMMARY
        elif [ "$PERCENTAGE" -ge 60 ]; then
          echo "‚ö†Ô∏è **–•–æ—Ä–æ—à–∞—è —Ä–∞–±–æ—Ç–∞, –Ω–æ –µ—Å—Ç—å –∫—É–¥–∞ —Ä–∞—Å—Ç–∏.**" >> $GITHUB_STEP_SUMMARY
        else
          echo "‚ùå **–ù—É–∂–Ω–æ —Å–µ—Ä—å–µ–∑–Ω–æ –ø–æ—Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞–¥ –∑–∞–¥–∞–Ω–∏—è–º–∏.**" >> $GITHUB_STEP_SUMMARY
        fi
        
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "*–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞* ‚Ä¢ $(date)" >> $GITHUB_STEP_SUMMARY
    
    - name: Report to GitHub Classroom
      uses: classroom-resources/autograding-grading-reporter@v1
      with:
        runners: "task_01:${{ steps.aggregate.outputs.task1_score || 0 }},task_02:${{ steps.aggregate.outputs.task2_score || 0 }},task_03:${{ steps.aggregate.outputs.task3_score || 0 }}"

  # JOB: –ü–†–û–í–ï–†–ö–ê –ö–ê–ß–ï–°–¢–í–ê –ö–û–î–ê (—Ç–æ–ª—å–∫–æ –∑–∞–¥–∞—á–∏)
  code-quality-check:
    name: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞
    runs-on: ubuntu-latest
    needs: grade-tasks
    if: always()
    
    steps:
    - uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: "3.10"

    - name: Install linters
      run: |
        pip install pylint flake8 ruff -q

    - name: Analyze student code
      run: |
        echo "## üîç –ê–ù–ê–õ–ò–ó –ö–ê–ß–ï–°–¢–í–ê –ö–û–î–ê" >> $GITHUB_STEP_SUMMARY
        echo "### –û—Ç—á–µ—Ç –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–∞ (–º–æ–∂–µ—Ç –≤–ª–∏—è—Ç—å –Ω–∞ –æ—Ü–µ–Ω–∫—É)" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ–∞–π–ª—ã –∑–∞–¥–∞—á –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
        TASK_FILES="task_01.py task_02.py task_03.py"
        FOUND_FILES=""
        
        echo "### üìã –§–∞–π–ª—ã –∑–∞–¥–∞—á:" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        for file in $TASK_FILES; do
          if [ -f "$file" ]; then
            echo "‚úÖ **$file** - –Ω–∞–π–¥–µ–Ω" >> $GITHUB_STEP_SUMMARY
            FOUND_FILES="$FOUND_FILES $file"
          else
            echo "‚ùå **$file** - –Ω–µ –Ω–∞–π–¥–µ–Ω" >> $GITHUB_STEP_SUMMARY
          fi
        done
        
        echo "" >> $GITHUB_STEP_SUMMARY
        
        if [ -z "$FOUND_FILES" ]; then
          echo "‚ö†Ô∏è **–ù–µ—Ç —Ñ–∞–π–ª–æ–≤ –∑–∞–¥–∞—á –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞!**" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "*–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª—ã task_01.py, task_02.py, task_03.py –≤ –∫–æ—Ä–Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è*" >> $GITHUB_STEP_SUMMARY
          exit 0
        fi
        
        echo "---" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        # –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø–æ —Ñ–∞–π–ª–∞–º
        echo "### üìä –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "| –§–∞–π–ª | PyLint | Flake8 | Ruff | –°—Ç–∞—Ç—É—Å |" >> $GITHUB_STEP_SUMMARY
        echo "|------|--------|--------|------|--------|" >> $GITHUB_STEP_SUMMARY
        
        for file in $FOUND_FILES; do
          # PyLint score
          pylint_score=$(pylint "$file" --exit-zero --score=yes 2>&1 | grep -o 'rated at [0-9.]*' | cut -d' ' -f3 || echo "0")
          
          # Flake8 errors
          flake8_errors=$(flake8 "$file" --count 2>/dev/null | tail -1)
          if ! [[ "$flake8_errors" =~ ^[0-9]+$ ]]; then
            flake8_errors="0"
          fi
          
          # Ruff errors
          ruff_errors=$(ruff check "$file" 2>&1 | grep -c ".py:" || echo "0")
          
          # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ–±—â–∏–π —Å—Ç–∞—Ç—É—Å
          if [ "$(echo "$pylint_score >= 8.0" | bc -l 2>/dev/null || echo 0)" -eq 1 ] && [ "$flake8_errors" -eq 0 ] && [ "$ruff_errors" -eq 0 ]; then
            status="‚úÖ –û—Ç–ª–∏—á–Ω–æ"
          elif [ "$(echo "$pylint_score >= 6.0" | bc -l 2>/dev/null || echo 0)" -eq 1 ] && [ "$flake8_errors" -le 5 ] && [ "$ruff_errors" -le 5 ]; then
            status="‚ö†Ô∏è –°—Ä–µ–¥–Ω–µ"
          else
            status="‚ùå –ü–ª–æ—Ö–æ"
          fi
          
          echo "| $file | $pylint_score/10 | $flake8_errors –æ—à–∏–±–æ–∫ | $ruff_errors –æ—à–∏–±–æ–∫ | $status |" >> $GITHUB_STEP_SUMMARY
        done
        
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "---" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        # –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞
        for file in $FOUND_FILES; do
          echo "### üìÑ –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑: **$file**" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –æ—à–∏–±–∫–∏ Ruff
          echo "#### ‚ö° –û—Å–Ω–æ–≤–Ω—ã–µ –æ—à–∏–±–∫–∏ (Ruff):" >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
          ruff check "$file" --select=E,F 2>&1 | head -20 >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Ü–µ–Ω–∫—É PyLint
          echo "#### üêç –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ (PyLint):" >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
          pylint "$file" --exit-zero --score=yes 2>&1 | tail -5 >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
        done
        
        # –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
        echo "### üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –∫–æ–¥–∞:" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**" >> $GITHUB_STEP_SUMMARY
        echo '   ```bash' >> $GITHUB_STEP_SUMMARY
        echo '   ruff check --fix .' >> $GITHUB_STEP_SUMMARY
        echo '   ```' >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "2. **–°–ª–µ–¥—É–π—Ç–µ PEP 8:**" >> $GITHUB_STEP_SUMMARY
        echo "   - 4 –ø—Ä–æ–±–µ–ª–∞ –¥–ª—è –æ—Ç—Å—Ç—É–ø–æ–≤" >> $GITHUB_STEP_SUMMARY
        echo "   - –ú–∞–∫—Å–∏–º—É–º 79 —Å–∏–º–≤–æ–ª–æ–≤ –≤ —Å—Ç—Ä–æ–∫–µ" >> $GITHUB_STEP_SUMMARY
        echo "   - –ü—Ä–æ–±–µ–ª—ã –≤–æ–∫—Ä—É–≥ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "3. **–î–æ–±–∞–≤–ª—è–π—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:**" >> $GITHUB_STEP_SUMMARY
        echo "   - –û–ø–∏—Å–∞–Ω–∏–µ —Å–ª–æ–∂–Ω—ã—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤" >> $GITHUB_STEP_SUMMARY
        echo "   - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∫ —Ñ—É–Ω–∫—Ü–∏—è–º" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "*–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞ –≤–ª–∏—è–µ—Ç –Ω–∞ –∏—Ç–æ–≥–æ–≤—É—é –æ—Ü–µ–Ω–∫—É!*" >> $GITHUB_STEP_SUMMARY